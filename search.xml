<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>第一篇博客</title>
      <link href="/2024/04/15/%E7%AC%AC%E4%B8%80%E7%AF%87%E5%8D%9A%E5%AE%A2/"/>
      <url>/2024/04/15/%E7%AC%AC%E4%B8%80%E7%AF%87%E5%8D%9A%E5%AE%A2/</url>
      
        <content type="html"><![CDATA[<h2 id="GROMACS-Water-学习记录（一）"><a href="#GROMACS-Water-学习记录（一）" class="headerlink" title="[GROMACS] Water - 学习记录（一）"></a>[GROMACS] Water - 学习记录（一）</h2><span id="more"></span><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>GROMACS模拟需要三个必须的文件：</p><ul><li><p>结构文件（.gro&#x2F;.pdb） - 包含每个原子的笛卡尔坐标。</p></li><li><p>拓扑文件（.top） - 包含键相互作用，非键相互作用。</p></li><li><p>输入文件（.mdp） - 包含如何运行这个系统的参数。</p><h4 id="拓扑文件"><a href="#拓扑文件" class="headerlink" title="拓扑文件"></a>拓扑文件</h4><p>拓扑文件通过使用 <code>#include</code>  来使用力场参数。创建一个<code>topol.top</code> 文件，如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;oplsaa.ff/forcefield.itp&quot;</span><br><span class="line">#include &quot;oplsaa.ff/tip4pew.itp&quot;</span><br><span class="line"></span><br><span class="line">[ System ]</span><br><span class="line">TIP4PEW</span><br><span class="line"></span><br><span class="line">[ Molecules ]</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>其中，使用OPLS-AA力场，水分子使用TIP4PEW模型。<code>[System]</code> 字段定义的是系统的名字，可以随便设置。 <code>[Molecules]</code> 字段 定于分子的<strong>名字和个数</strong>。</p><h4 id="结构文件"><a href="#结构文件" class="headerlink" title="结构文件"></a>结构文件</h4><p>TIP4PEW结构文件，在GROMACS中已经提供。可以在<code>$GMXDATA/top</code> 中找到。<code>tip4p.gro</code> 截取部分如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">216 TIP4P Water Molecules Equilibrated for 20 ps at 300 K </span><br><span class="line">  864</span><br><span class="line">    1SOL     OW    1   1.736   0.839   0.257 -0.0525 -0.0128  0.1333</span><br><span class="line">    1SOL    HW1    2   1.777   0.781   0.322  0.3406  0.5030  0.3534</span><br><span class="line">    1SOL    HW2    3   1.643   0.831   0.274  0.0528  0.2742  0.9186</span><br></pre></td></tr></table></figure><p>其中，第一行是注释行，无关紧要。第二行是分子个数。（<strong>原子类型需要保证不一致</strong>）</p><p>之后，溶剂化体系（<strong>GROMACS我使用的是mpi的并行运算</strong>）：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gmx_mpi solvate -cs tip4p -o conf.gro -box 2.3 2.3 2.3 -p topol.top</span><br></pre></td></tr></table></figure><p>使用2.3 nm的盒子中，填充水分子。</p><h4 id="输入文件"><a href="#输入文件" class="headerlink" title="输入文件"></a>输入文件</h4><p>模拟通常包括3个部分：能量最小化 - 温度和压力平衡 - 模拟生产。</p><h5 id="能量最小化"><a href="#能量最小化" class="headerlink" title="能量最小化"></a>能量最小化</h5><p>创建mdp文件夹，其中包含运行的输入文件，目录结构如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mdp/</span><br><span class="line">- min.mdp</span><br><span class="line">- min2.mdp</span><br><span class="line">- eql.mdp</span><br><span class="line">- eql2.mdp</span><br><span class="line">- prd.mdp</span><br></pre></td></tr></table></figure><p>其中，min.mdp代码如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">define                   = -DFLEXIBLE</span><br><span class="line">integrator               = steep</span><br><span class="line">nsteps                   = 100000</span><br><span class="line"></span><br><span class="line">nstenergy                = 500</span><br><span class="line">nstlog                   = 500</span><br><span class="line">nstxout-compressed       = 1000</span><br><span class="line"></span><br><span class="line">constraint-algorithm     = lincs</span><br><span class="line">constraints              = h-bonds</span><br><span class="line"></span><br><span class="line">cutoff-scheme            = Verlet</span><br><span class="line"></span><br><span class="line">coulombtype              = PME</span><br><span class="line">rcoulomb                 = 1.0</span><br><span class="line"></span><br><span class="line">vdwtype                  = Cut-off</span><br><span class="line">rvdw                     = 1.0</span><br><span class="line">DispCorr                 = EnerPres</span><br></pre></td></tr></table></figure><p>在mdp文件夹同一位置运行如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ gmx_mpi grompp -f mdp/min.mdp -o min.tpr -pp min.top -po min.mdp</span><br><span class="line">$ gmx_mpi mdrun -s min.tpr -o min.trr -x min.xtc -c min.gro -e min.edr -g min.log</span><br><span class="line"></span><br><span class="line">$ gmx_mpi grompp -f mdp/min2.mdp -o min2.tpr -pp min2.top -po min2.mdp -c min.gro</span><br><span class="line">$ gmx_mpi mdrun -s min2.tpr -o min2.trr -x min2.xtc -c min2.gro -e min2.edr -g min2.log</span><br></pre></td></tr></table></figure><p>其中，<code>-f</code> 指向输入文件，如果没有<code>-c</code> 和<code>-p</code> 标志，意味着GROMACS使用默认的结构文件<code>conf.gro</code>  和拓扑文件<code>topol.top</code> ，因此这个两个文件也必须和mdp文件夹在同一目录。</p><p>注意事项：在模拟过程中，可能出现<code>Warning</code> 警告，如何是和L-BFGS的效率相关，可以使用<code>-maxwarn 1</code> 忽略掉，如果是其他的警告，需要仔细查看。</p><p>可以使用GROMACS输出相关的能量（<strong>代码运行之后，你需要选择输出的能量文件</strong>）文件：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gmx_mpi energy -f min.edr -o min-energy.xvg</span><br></pre></td></tr></table></figure><h5 id="温度和压力平衡"><a href="#温度和压力平衡" class="headerlink" title="温度和压力平衡"></a>温度和压力平衡</h5><p>这一步需要进行温度和压力平衡，其中温度平恒eql.mdp文件如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">integrator               = md        </span><br><span class="line">dt                       = 0.002     ; 2 fs</span><br><span class="line">nsteps                   = 500000     ; 1 ns</span><br><span class="line"></span><br><span class="line">nstenergy                = 200</span><br><span class="line">nstlog                   = 2000</span><br><span class="line">nstxout-compressed       = 10000</span><br><span class="line"></span><br><span class="line">gen-vel                  = yes</span><br><span class="line">gen-temp                 = 298.15</span><br><span class="line"></span><br><span class="line">constraint-algorithm     = lincs</span><br><span class="line">constraints              = h-bonds</span><br><span class="line"></span><br><span class="line">cutoff-scheme            = Verlet</span><br><span class="line"></span><br><span class="line">coulombtype              = PME</span><br><span class="line">rcoulomb                 = 1.0</span><br><span class="line"></span><br><span class="line">vdwtype                  = Cut-off</span><br><span class="line">rvdw                     = 1.0</span><br><span class="line">DispCorr                 = EnerPres</span><br><span class="line"></span><br><span class="line">tcoupl                   = Nose-Hoover</span><br><span class="line">tc-grps                  = System</span><br><span class="line">tau-t                    = 2.0</span><br><span class="line">ref-t                    = 298.15</span><br><span class="line">nhchainlength            = 1</span><br></pre></td></tr></table></figure><p>压力平衡文件，eql2.mdp文件如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">integrator               = md        </span><br><span class="line">dt                       = 0.002     ; 2 fs</span><br><span class="line">nsteps                   = 1000000    ; 1.0 ns</span><br><span class="line"></span><br><span class="line">nstenergy                = 200</span><br><span class="line">nstlog                   = 2000</span><br><span class="line">nstxout-compressed       = 10000</span><br><span class="line"></span><br><span class="line">continuation             = yes</span><br><span class="line">constraint-algorithm     = lincs</span><br><span class="line">constraints              = h-bonds</span><br><span class="line"></span><br><span class="line">cutoff-scheme            = Verlet</span><br><span class="line"></span><br><span class="line">coulombtype              = PME</span><br><span class="line">rcoulomb                 = 1.0</span><br><span class="line"></span><br><span class="line">vdwtype                  = Cut-off</span><br><span class="line">rvdw                     = 1.0</span><br><span class="line">DispCorr                 = EnerPres</span><br><span class="line"></span><br><span class="line">tcoupl                   = Nose-Hoover</span><br><span class="line">tc-grps                  = System</span><br><span class="line">tau-t                    = 2.0</span><br><span class="line">ref-t                    = 298.15</span><br><span class="line">nhchainlength            = 1</span><br><span class="line"></span><br><span class="line">pcoupl                   = Parrinello-Rahman </span><br><span class="line">tau_p                    = 4.0</span><br><span class="line">compressibility          = 4.46e-5</span><br><span class="line">ref_p                    = 1.0 </span><br></pre></td></tr></table></figure><h5 id="模拟生产"><a href="#模拟生产" class="headerlink" title="模拟生产"></a>模拟生产</h5><p>模拟生产prd.mdp文件如下:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">integrator               = md        </span><br><span class="line">dt                       = 0.002     ; 2 fs</span><br><span class="line">nsteps                   = 5000000   ; 10.0 ns</span><br><span class="line"></span><br><span class="line">nstenergy                = 5000</span><br><span class="line">nstlog                   = 5000</span><br><span class="line">nstxout-compressed       = 2000</span><br><span class="line"></span><br><span class="line">continuation             = yes</span><br><span class="line">constraint-algorithm     = lincs</span><br><span class="line">constraints              = h-bonds</span><br><span class="line"></span><br><span class="line">cutoff-scheme            = Verlet</span><br><span class="line"></span><br><span class="line">coulombtype              = PME</span><br><span class="line">rcoulomb                 = 1.0</span><br><span class="line"></span><br><span class="line">vdwtype                  = Cut-off</span><br><span class="line">rvdw                     = 1.0</span><br><span class="line">DispCorr                 = EnerPres</span><br><span class="line"></span><br><span class="line">tcoupl                   = Nose-Hoover</span><br><span class="line">tc-grps                  = System</span><br><span class="line">tau-t                    = 2.0</span><br><span class="line">ref-t                    = 298.15</span><br><span class="line">nhchainlength            = 1</span><br><span class="line"></span><br><span class="line">pcoupl                   = Parrinello-Rahman </span><br><span class="line">tau_p                    = 4.0</span><br><span class="line">compressibility          = 4.46e-5</span><br><span class="line">ref_p                    = 1.0 </span><br></pre></td></tr></table></figure></li></ul><h2 id="轨迹分析"><a href="#轨迹分析" class="headerlink" title="轨迹分析"></a>轨迹分析</h2><p>可以使用vmd进行可视化：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vmd prd.gro prd.xtc</span><br></pre></td></tr></table></figure><p>上面可视化轨迹并不推荐，而是通过<code>gmx_mpi trjconv</code> 处理之后，通过vmd可视化。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gmx_mpi trjconv -f prd.xtc -s prd.tpr -pbc mol -o prd-mol.xtc</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
